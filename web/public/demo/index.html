<!DOCTYPE html><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>trinity TV Demo Player</title>
<style>
html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: rgb(0, 0, 0); display:flex; align-items: center; justify-content: center; }
canvas { max-width: 100%; max-height: 100%; min-width: 100%; min-height: 100%; object-fit: contain; }
canvas.no-pointerlock { cursor: auto !important; }
#status { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #aaa; font-family: monospace; font-size: 14px; z-index: 10; white-space: pre; text-align: center; }
</style>

<canvas id=canvas tabindex=0></canvas>
<div id=status>Loading...</div>

<script>
// Prevent browser from stealing keys that the game needs (capture phase, before SDL)
window.addEventListener('keydown', e => {
    if (e.key === 'Tab') e.preventDefault();
}, true);
document.addEventListener('pointerlockchange', () => {
    document.getElementById('canvas').classList.toggle('no-pointerlock', !document.pointerLockElement);
});
</script>

<script type=module>
import { loadDemo } from './demo-loader.js';

const DEMOPLAYER = true;
const urlParams = new URLSearchParams(window.location.search);

// Demo URL: from path for demoplayer (/demo/uuid), from query param otherwise (?demo=url)
let demoUrl = urlParams.get('demo');
if (!demoUrl && DEMOPLAYER) {
    const pathMatch = window.location.pathname.match(/\/demo\/([0-9a-f-]+)/);
    if (pathMatch) demoUrl = `/demos/${pathMatch[1]}.tvd`;
}

loadDemo({
    canvas: document.getElementById('canvas'),
    statusEl: document.getElementById('status'),
    enginePath: './',
    demoUrl: demoUrl,
    extraPk3s: urlParams.getAll('pk3'),
    extraArgs: urlParams.get('args') || '',
});
</script>
